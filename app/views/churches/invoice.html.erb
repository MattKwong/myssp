<%= render 'layouts/myssp_header' %>
<div id="active_admin_content">
  <div id="main_content_wrapper">
     <div id="main_content">
        <%= render 'layouts/myssp_group_data' %>
        <div class="panel">
           <h3>Invoice Information</h3>
              <div class="panel_contents">
                 <table border="0" cellspacing="0" cellpadding="0">
                    <tbody>
                       <tr>
                          <td>Balance Due:</td><td class='table_data'><%= number_to_currency(@screen_info[:invoice_data][:current_balance]) %></td>
                       </tr>
                          <td>Payments</td>
                          <th>Date</th><th>Method</th><th>Amount</th><th>Notes</th>
                          <% @screen_info[:invoice_data][:payments].each do |p| %>
                             <tr>
                               <td></td>
                               <td><%= p.payment_date.strftime("%m/%d/%y") %></td>
                               <td><%= p.payment_method %></td>
                               <td><%= number_to_currency(p.payment_amount) %></td>
                               <td><%= p.payment_notes %></td>
                             </tr>
                          <% end %>
                          <tr></tr>
                          <td>Schedule Changes</td>
                          <th>Date</th><th>Youth Change</th><th>Counselor Change</th><th>Total Change</th><th>Changed By</th>
                          <% @screen_info[:invoice_data][:changes].each do |c| %>
                             <tr>
                               <td></td>
                               <td><%= c.created_at.strftime("%m/%d/%y") %></td>
                               <td><%= c.old_youth - c.new_youth %></td>
                               <td><%= c.old_counselors - c.new_counselors %></td>
                               <td><%= c.old_total - c.new_total %></td>
                               <td><%= c.updated_by %></td>
                             </tr>
                          <% end %>
                          <tr></tr>
                          <td>Adjustments</td>
                          <th>Date</th><th>Amount</th><th>Reason Code</th><th>Notes</th><th>Changed By</th>
                          <% @screen_info[:invoice_data][:adjustments].each do |a| %>
                             <tr>
                               <td></td>
                               <td><%= a.created_at.strftime("%m/%d/%y") %></td>
                               <td><%= number_to_currency(a.amount) %></td>
                               <td><%= a.reason_code %></td>
                               <td><%= a.note %></td>
                               <td><%= a.updated_by %></td>
                             </tr>
                          <% end %>
                    </tbody>
                 </table>
              </div>
              </div>
        <div class="panel">
           <h3>Current Statement</h3>
              <div class="panel_contents">
                 <table border="0" cellspacing="0" cellpadding="0">
                    <thead>
                        <th>Date</th>
                        <th >Description</th>
                        <th>Amount Due</th>
                        <th>Amount Received</th>
                    </thead>
                    <tbody>
                        <% @screen_info[:invoice_data][:event_list].each do |e| %>
                            <tr>
                              <td><%= e[:date].strftime("%m/%d/%y") %></td>
                              <td><%= e[:name] %></td>
                              <td><% unless e[:amount_due].nil? %>
                                    <%= e[:amount_due] %><% end %>
                              </td>
                              <td><% unless e[:amount_received].nil? %>
                                    <%= e[:amount_received] %><% end %>
                              </td>
                            </tr>
                        <% end %>
                        <tr>
                            <td></td>
                            <td>Totals</td>
                            <td><%= number_to_currency(@screen_info[:invoice_data][:total_due]) %></td>
                            <td><%= number_to_currency(@screen_info[:invoice_data][:amount_paid]) %></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Balance Due</td>
                            <td><%= number_to_currency(@screen_info[:invoice_data][:current_balance]) %></td>
                         </tr>
                    </tbody>
                 </table>
                <p><%= link_to_function("Print this statement", "javascript:print()") %></p>
              </div>
           </div>
        </div>
        <div class="panel">
        <% if @screen_info[:invoice_data][:second_payment_due?] %>
              <h3><%= "
              Current Invoice:: Due date: #{@screen_info[:invoice_data][:payment_schedule].second_payment_date.strftime("%m/%d/%y")}"%></h3>
              <div class="panel_contents">
                <table border="0" cellspacing="0" cellpadding="0">
                   <thead>
                       <th>Date</th>
                       <th >Description</th>
                       <th>Amount Due</th>
                       <th>Amount Received</th>
                   </thead>
                   <tbody>
                       <% @screen_info[:invoice_data][:event_list].each do |e| %>
                           <tr>
                             <td><%= e[:date].strftime("%m/%d/%y") %></td>
                             <td><%= e[:name] %></td>
                             <td><% unless e[:amount_due].nil? %>
                                   <%= e[:amount_due] %><% end %>
                             </td>
                             <td><% unless e[:amount_received].nil? %>
                                   <%= e[:amount_received] %><% end %>
                             </td>
                           </tr>
                       <% end %>
                       <tr>
                           <td></td>
                           <td>Paid to date</td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:amount_paid]) %></td>
                       </tr>
                       <tr>
                           <td></td>
                           <td>Balance Due</td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:current_balance]) %></td>
                        </tr>
                   </tbody>
                </table>
               <p><%= link_to_function("Print this statement", "javascript:print()") %></p>
             </div>
             <% else %>
              <h3><%= "Current Invoice:: Due date: #{@screen_info[:invoice_data][:payment_schedule].final_payment_date.strftime("%m/%d/%y")}"%></h3>
              <div class="panel_contents">
                <table border="0" cellspacing="0" cellpadding="0">
                   <thead>
                       <th></th>
                       <th>Number</th>
                       <th>Amount Per</th>
                       <th>Total Amount</th>
                   </thead>
                   <tbody>
                       <tr>
                           <td>Deposits</td>
                           <td><%= @screen_info[:invoice_data][:deposits_due_count] %></td>
                           <td><%= number_to_currency @screen_info[:invoice_data][:payment_schedule].deposit %></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:deposit_amount]) %></td>
                       </tr>
                       <tr>
                           <td>2nd Payments</td>
                           <td><%= @screen_info[:invoice_data][:second_payments_due_count] %></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:payment_schedule].second_payment) %></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:second_payment_amount]) %></td>
                       </tr>
                       <tr>
                           <td>Final Payments</td>
                           <td><%= @screen_info[:scheduled_group].current_total %></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:payment_schedule].final_payment) %></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:final_payment_amount]) %></td>
                       </tr>
                       <tr>
                           <td>Total</td>
                           <td></td>
                           <td></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:deposit_amount] +
                                                              @screen_info[:invoice_data][:second_payment_amount] +
                                                            @screen_info[:invoice_data][:final_payment_amount]) %></td>
                       </tr>
                       <tr>
                           <td>Paid to date</td>
                           <td></td>
                           <td></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:amount_paid]) %></td>
                       </tr>
                       <% if @screen_info[:invoice_data][:second_late_payment_required?]%>
                         <tr>
                           <td>Second Payment Late Charge</td>
                           <td></td>
                           <td></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:second_late_payment_amount]) %></td>
                         </tr>
                       <% end %>
                       <% if @screen_info[:invoice_data][:final_late_payment_required?]%>
                         <tr>
                           <td>Second Payment Late Charge</td>
                           <td></td>
                           <td></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:final_late_payment_amount]) %></td>
                         </tr>
                       <% end %>
                       <tr>
                           <td>Less Adjustments</td>
                           <td></td>
                           <td></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:adjustment_total]) %></td>
                       </tr>
                       <tr>
                           <td>Balance Due</td>
                           <td></td>
                           <td></td>
                           <td><%= number_to_currency(@screen_info[:invoice_data][:current_balance]) %></td>
                        </tr>
                   </tbody>
                </table>
               <p><%= link_to_function("Print this invoice", "javascript:print()") %></p>
             </div>
          <% end %>
        </div>
     </div>
      </div>
 </div>

