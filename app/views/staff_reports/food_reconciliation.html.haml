#active_admin_content
  .index_content
    .index_as_table
      %table.index_table
        %thead
          %tr
            %th{:colspan => 7}
            %th{:colspan => @inventories.length, :style => "text-align:center;"} Amount Consumed Since Prior Inventory
            %th
            %th
        %thead
          %tr
            %th Item Name
            %th Total Purchased
            %th Currently In Inventory
            %th Average Cost
            %th In Inventory Cost
            %th Purchase Cost
            %th Unit
            - @inventories.each do |inventory|
              %th= inventory.date.strftime("%b %d")
            %th Total Consumed Amount
            %th Total Consumed Cost
        %tbody
          - total_inventory_value_at_cost = total_purchased_for_program = total_total_consumed_cost = 0
          - @items.each do |item|
            %tr
              %td= link_to item.name, item
              %td= "%.2f" % (item.purchased_for_program @program, @program.start_date, @date)
              %td= "%.2f %s" % [item.in_inventory_for_program_at(@program, @date), item.base_unit]
              %td= number_to_currency(item.average_cost(@program, @date))
              %td= number_to_currency(item.inventory_value_at_cost(@program, @date))
              -  total_inventory_value_at_cost += item.inventory_value_at_cost(@program, @date)
              %td= number_to_currency(item.purchased_for_program_value(@program, @program.start_date, @date))
              - total_purchased_for_program += item.purchased_for_program_value(@program, @program.start_date, @date)
              %td= item.base_unit
              - @inventories.each do |inventory|
                - inv = inventory.food_inventory_food_items.for_item(item).first
                %td= "%.2f" % inv.consumed unless inv.nil?
              - all_inv = item.food_inventory_food_items.for_program(@program)
              %td= "%.2f" % (all_inv.map &:consumed).sum
              %td= number_to_currency((all_inv.map &:total_consumed_cost).sum)
              - total_total_consumed_cost += (all_inv.map &:total_consumed_cost).sum
          %tfoot
            %th{:colspan => 4}
            %th= number_to_currency(total_inventory_value_at_cost)
            %th= number_to_currency(total_purchased_for_program)
            %th{:colspan => @inventories.length + 2}
            %th= number_to_currency(total_total_consumed_cost)
